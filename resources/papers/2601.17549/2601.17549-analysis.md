---
arxiv_id: "2601.17549"
title: "Breaking the Protocol: Security Analysis of the Model Context Protocol Specification and Prompt Injection Vulnerabilities in Tool-Integrated LLM Agents"
authors: [Narek Maloyan, Dmitry Namiot]
analyzed: 2026-02-04
---

## Paper Summary

This paper presents the **first rigorous security analysis of the MCP specification itself** (not just implementations), identifying three fundamental protocol-level vulnerabilities. It proposes AttestMCP, a backward-compatible extension with capability attestation and message authentication.

**Core contribution:** Distinguishes protocol vulnerabilities (specification flaws) from implementation vulnerabilities (bugs).

**Key finding:** MCP's architecture amplifies attack success rates by 23-41% compared to equivalent non-MCP integrations.

## Attack/Threat Coverage

### Three Protocol-Level Vulnerabilities

#### Vulnerability 1: Least Privilege Violation (Absence of Capability Attestation)

**Problem:** Capability declarations are self-asserted without verification.

```json
"capabilities": {
  "tools": { "listChanged": true },
  "resources": { "subscribe": true },
  "sampling": {}
}
```

**Attack:** Server claiming only `resources` capability can later invoke `sampling/createMessage` to inject prompts.

**Violated property:** Least Privilege - principals possess only necessary capabilities.

#### Vulnerability 2: Sampling Without Origin Authentication

**Problem:** Server-originated prompts indistinguishable from user-originated prompts.

```json
{
  "method": "sampling/createMessage",
  "params": {
    "messages": [{"role": "user", "content": "..."}],
    "maxTokens": 1000
  }
}
```

**UI Analysis:**
| Host | Version | Visual Indicator | Distinguishable |
|------|---------|------------------|-----------------|
| Claude Desktop | 1.2.3 | None | No |
| Cursor | 0.44 | None | No |
| Continue | 0.9 | None | No |

**Violated property:** Origin Authenticity

#### Vulnerability 3: Implicit Trust Propagation

**Problem:** No isolation boundaries between multiple servers.

**Attack vectors:**
1. Server A embeds instructions causing invocations on Server B
2. Data from Server B exfiltrated via Server A
3. Shared context enables persistence

**Isolation-Utility Tradeoff:**
| Isolation Level | ASR | Task Completion |
|-----------------|-----|-----------------|
| None (MCP default) | 61.3% | 94.2% |
| User-prompted cross-flow | 31.7% | 87.4% |
| Strict (no cross-flow) | 8.7% | 61.8% |

### Message Integrity Analysis

| Property | Required | MCP v1.0 |
|----------|----------|----------|
| Message Authentication | Yes | No |
| Replay Protection | Yes | No |
| Capability Binding | Yes | No |
| Origin Identification | Yes | Partial* |
| Integrity Verification | Yes | No |

*Transport-level only; not in message payload

### Server Discovery Attack Vectors

Survey of 127 MCP server installation guides:
1. **Typosquatting (34%)** - Near-identical package names
2. **Supply Chain Compromise (28%)** - Upstream poisoning
3. **Social Engineering (23%)** - Tutorials directing to malicious repos
4. **Marketplace Poisoning (15%)** - Limited vetting in IDE extensions

**Finding:** 73% of guides instruct running `npx` directly from GitHub URLs without integrity verification.

## Defense/Mitigation Proposals

### PROTOAMP Framework

Bridges existing agent security benchmarks to MCP-compliant infrastructure:
- MCP server wrappers preserving semantic equivalence
- Attack injection at three protocol layers
- Measurement infrastructure for JSON-RPC message logging

### AttestMCP Protocol Extension

Backward-compatible extension adding:

#### 1. Capability Attestation
- Cryptographic proof of capability possession
- Signed certificates from capability authority

#### 2. Message Authentication
- HMAC-SHA256 signatures on all JSON-RPC messages
- Content bound to session context

#### 3. Trust Model Options
- Multiple trust configurations available
- Default: "user-prompted" isolation

### AttestMCP Effectiveness

| Metric | Before | After |
|--------|--------|-------|
| Attack Success Rate | 52.8% | 12.4% |
| Median Latency Overhead | - | 8.3ms/message |

### Prompt Engineering Baseline

System prompt: "Never pass data between different tool servers without explicit user confirmation"
- Reduces cross-server ASR: 61.3% → 47.2%
- Still higher than AttestMCP's 8.7%
- **Conclusion:** Prompt-level defenses insufficient; protocol-level changes needed

## Experimental Results

### Protocol Amplification Effect

| Attack Type | Baseline | MCP | Amplification |
|-------------|----------|-----|---------------|
| Indirect Injection (Resource) | 31.2% | 47.8% | +16.6% |
| Tool Response Manipulation | 28.4% | 52.1% | +23.7% |
| Cross-Server Propagation | 19.7% | 61.3% | +41.6% |
| Sampling-Based Injection | N/A | 67.2% | — |
| **Overall** | 26.4% | 52.8% | +26.4% |

### Sampling Attack Analysis

| Model | ASR | Exfiltration Rate | Persistence |
|-------|-----|-------------------|-------------|
| Claude-3.5-Sonnet | 58.3% | 42.1% | 31.7% |
| GPT-4o | 71.4% | 53.8% | 38.2% |
| Llama-3.1-70B | 72.1% | 61.2% | 44.6% |

### Multi-Server Scaling

| Servers | ASR | Cascade Rate |
|---------|-----|--------------|
| 1 | 47.8% | N/A |
| 2 | 58.4% | 34.2% |
| 3 | 67.1% | 51.8% |
| 5 | 78.3% | 72.4% |

**Key finding:** Attack success scales with server count; cascade rate reaches 72.4% with 5 servers.

### Benchmark Comparison (Original vs. MCP)

| Benchmark | Setting | Original | MCP |
|-----------|---------|----------|-----|
| InjecAgent | GPT-4 | 24-48% | 51.2% |
| AgentDojo | Best agent | <25% | 38.7% |
| Agent-SafetyBench | Safety score | <60% | 47.3% |

## Discoveries (for inventory)

### CVEs Referenced
- CVE-2025-49596 - MCP implementation bug
- CVE-2025-68143 - MCP implementation bug
- CVE-2025-11445 - MCPSec documented

### Projects/Papers Referenced
- MCPSecBench (Yang et al.) - Already in inventory
- MCP-Bench (Wang et al.) - Capability benchmark
- MCPSec project - Real-world vulnerability documentation
- MCPGuard - Runtime scanning

### MCP Servers Tested
- mcp-server-filesystem
- mcp-server-git
- mcp-server-sqlite
- mcp-server-slack
- adversarial-mcp (custom)

### Attack Scenario Counts
- InjecAgent adaptations: 312
- AgentDojo adaptations: 398
- Novel protocol-specific: 137
- **Total:** 847 scenarios

## Extractable Assets

### Protocol Vulnerability Classification

| Class | Description | Mitigation |
|-------|-------------|------------|
| Protocol | Specification flaws affecting all implementations | Requires spec changes |
| Implementation | Bugs in specific servers | Can be patched |

### PROTOAMP Components
1. MCP Server Wrappers - Semantic equivalence preservation
2. Attack Injection Points - Resource, tool response, sampling
3. Measurement Infrastructure - JSON-RPC logging

### Trust Model Hierarchy
1. None (MCP default) - Full cross-server data flow
2. User-prompted - Explicit authorization for cross-flow
3. Strict - No cross-server data flow

## Limitations & Gaps

**Scope:**
- Protocol analysis (not implementation auditing)
- Five MCP servers tested
- Three LLM backends

**Acknowledged:**
- Prompt injection is established - contribution is MCP-specific amplification measurement
- AttestMCP adds latency (8.3ms median)

**Not addressed:**
- Large-scale real-world deployment
- Performance at scale
- Backward compatibility challenges

## Notable Observations

1. **Protocol vs. Implementation distinction** - Critical framing; protocol flaws require specification changes
2. **23-41% amplification** - MCP significantly worsens existing vulnerabilities
3. **Sampling is dangerous** - Server-initiated LLM completions with user role creates novel attack
4. **Cascade effect** - More servers = exponentially worse security
5. **UI indicators absent** - No tested host distinguishes sampling-derived messages
6. **73% unsafe installation** - Majority of guides promote insecure practices
7. **AttestMCP works** - 52.8% → 12.4% ASR with modest overhead
8. **Backward compatibility** - Extension design preserves existing functionality
9. **Isolation-utility tradeoff quantified** - Important design guidance for future work
